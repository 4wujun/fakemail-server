#!groovy

plugins {
	id 'com.moowork.node' version '1.2.0'
}

apply plugin: 'eclipse'

node {
	version = '8.9.3'
	download = true
}

description = "Angular 4 frontend"

task clean(type: Delete) {
	group = 'build'
	description = 'Clean-up generated files'
	delete "${projectDir}/coverage",
		fileTree(dir: projectDir, 
			includes: [ "TEST*.xml", "ut_report-*.xml" ])
}

task buildClientDev(type: NpmTask, dependsOn: 'npmInstall') {
	group = 'build'
	description = 'Compile client side folder for development'
	args = ['run','buildDev']
}

task buildClientWatch(type: NpmTask, dependsOn: 'npmInstall') {
	group = 'application'
	description = 'Build and watches the client side assets for rebuilding'
	args = ['run','buildWatch']
}

task buildClient(type: NpmTask, dependsOn: 'npmInstall') {
	group = 'build'
	description = 'Compile client side folder for production'
	args = ['run','build']
}

task testNpm(type: NpmTask, dependsOn: 'npmInstall') {
	group = 'verification'
	description = 'Launch unit tests'
	args = ['run', 'test']
}

task testCoverage(type: NpmTask, dependsOn: 'npmInstall') {
	group = 'verification'
	description = 'Launch coverage analysis'
	args = ['run', 'testCoverage']
}

eclipse {
	project {
		natures 'org.eclipse.buildship.core.gradleprojectnature'
		natures 'org.eclipse.wst.common.project.facet.core.nature'
		buildCommand 'org.eclipse.wst.common.project.facet.core.builder'
		buildCommand 'org.eclipse.wst.validation.validationbuilder'
	}
}

sonarqube {
	properties {
		property 'sonar.sources', 'src'
		property 'sonar.exclusions', 'src/test.ts,**/*.spec.ts'
		property 'sonar.tests', 'src'
		property 'sonar.test.inclusions', 'src/test.ts,**/*.spec.ts'
		property 'sonar.javascript.lcov.reportPaths', 'coverage/lcov.info'
		property 'sonar.typescript.lcov.reportPaths', 'coverage/lcov.info'
	}
}

